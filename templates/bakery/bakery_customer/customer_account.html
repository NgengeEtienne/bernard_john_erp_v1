{% extends '../../base2.html' %}
{% block title %} Customers {% endblock title %}


{% block content %}

<div class="content-overlay"></div>
<div class="content-wrapper">
    <div class="content-body">


<section class="row all-contacts">
    <div class="col-12">
        <div class="card" style="height: 45px;"> <!-- Set a specific height -->
            <div class="card-head">
                <div class="card-header">
                    <h4 class="card-title">{{customer.customer_name}}'s Account</h4>
                    <div class="heading-elements mt-0 button-margin"> <!-- Added class here -->
                        <a href="{% url 'bakery:customer' %}">
                            <button class="btn btn-primary btn-md" style="padding: 5px 10px;" data-toggle="modal" data-target="">
                                <i class="d-md-none d-block ft-plus white"></i>
                                <span class="d-md-block d-none"><i class="la la-home"></i> Customer List </span>
                            </button>
                        </a>

                        <a href="{% url 'bakery:customer-edit' customer.slug %}">
                            <button class="btn btn-primary btn-md" style="padding: 5px 10px;" data-toggle="modal" data-target="">
                                <i class="d-md-none d-block ft-plus white"></i>
                                <span class="d-md-block d-none"><i class="la la-pencil"></i> Edit Customer Profile </span>
                            </button>
                        </a>
                        
                        <!-- Edit Contact -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


      <section id="patient-profile">
          <div class="row match-height">
              <div class="col-lg-6 col-md-12">
                  <div class="card">
                      <div class="card-body">
                          <div class="row">
                              <div class="col-lg-4 col-md-4 d-flex justify-content-around">
                                  <div class="patient-img-name text-center">

                                      {% if customer.account_photo %}
                                          <img src="{{ customer.account_photo.url }}" alt="" class="card-img-top mb-1 patient-img img-fluid rounded-circle">
                                      {% else %}
                                          <img src="/static/app-assets/images/portrait/small/avatar-s-19.png" alt="" class="card-img-top mb-1 patient-img img-fluid rounded-circle">
                                      {% endif %}
                                      <h4>{{customer.customer_name}}</h4>
                                      <h6>{{customer_type}}</h6>
                                  </div>
                              </div>
                              <div class="col-lg-8 col-md-8 d-flex justify-content-around">
                                  <div class="patient-info">
                                      <ul class="list-unstyled">
                                          <li>
                                              <div class="patient-info-heading"><h6 class="text-dark">Account Name: <strong>{{customer.customer_name}} </strong></h6>                                           </li>
                                          <li>
                                            <div class="patient-info-heading">
                                                <h6 class="text-dark">Business Type: <strong>{{ customer.customer_type }}</strong></h6>
                                            </div>
                                          </li>
                                          <li>
                                              <div class="patient-info-heading"><h6 class="text-dark">Company: <strong>{{customer.company_name}}</strong></h6></div>
                                          </li>
                                          <li>
                                            <div class="patient-info-heading"><h6 class="text-dark">Area: <strong>{{customer.area}}</strong></h6></div>
                                        </li>
                                        <li>
                                            <div class="patient-info-heading"><h6 class="text-dark">Quarter: <strong>{{customer.quarter}}</strong></h6></div>
                                        </li>
                                        <li>
                                            <div class="patient-info-heading"><h6 class="text-dark">Address: <strong>{{customer.address}}</strong></h6></div>
                                        </li>

                                      </ul>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="col-lg-6 col-md-4">
                  <div class="card bg-gradient-y-warning">
                      <div class="card-header">
                          <h5 class="card-title text-white">Account Information</h5>
                          <hr>
                      </div>
                      <div class="card-content mx-1 mb-4">
                          <ul class="list-unstyled text-white">
                              <li> <h5 class="card-title text-blue">Opening Balance : <strong>{{opening_balance}}</strong> </h5></li>
                              <hr>
                              <li> <h5 class="card-title text-black">Total Order :<strong>{{total_invoices}}</strong> </h5></li>
                              <hr>
                              <li> <h5 class="card-title text-black">Total Discount : <strong>{{total_discount}}</strong> </h5></li>
                              <hr>
                              <li> <h5 class="card-title text-black">Total Return : <strong>{{total_returns}}</strong> </h5></li>
                              <hr>
                              <li> <h5 class="card-title text-black">Total Payments : <strong>{{total_payments}}</strong> </h5></li>
                              <hr >
                              <li> <h5>Account Balance : {{account_balance}} </h5></li>
                              <hr>
                              <p class="card-title text-black">Commission Earned: <strong>{{commission_earned}}</strong> </p>
                          </ul>
                      </div>
                  </div>
              </div>
          </div>
      </section>

        <!-- Zero configuration table -->
        <section id="configuration">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <!-- Card header for customer orders -->
                        <div class="card-header">
                            <h4 class="card-title">Customer Orders</h4>
                            <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                    <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                    <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                    <li><a data-action="close"><i class="ft-x"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Card content with form and table -->
                        <div class="card-content collapse show">
                            <div class="card-body card-dashboard">

                                <p class="card-text">
                                    <!-- Display total return amount -->
                                    <strong>Total Orders Amount: {{ net_total|floatformat:0 }} cfa </strong>
                                </p>

                                <!-- Form for filtering orders -->
                                <form method="GET" action="">
                                    <div class="row">
                                        <!-- Start Date Filter -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="start_date">Start Date</label>
                                                <input type="date" class="form-control" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
                                            </div>
                                        </div>
                                        
                                        <!-- End Date Filter -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="end_date">End Date</label>
                                                <input type="date" class="form-control" id="end_date" name="end_date" value="{{ request.GET.end_date }}">
                                            </div>
                                        </div>
                                        
                                        <!-- Invoice Number Filter -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="invoice_number">Invoice Number</label>
                                                <input type="text" class="form-control" id="invoice_number" name="invoice_number" placeholder="Invoice #" value="{{ request.GET.invoice_number }}">
                                            </div>
                                        </div>

                                        <!-- Status Filter -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="status">Status</label>
                                                <select class="form-control" id="status" name="status">
                                                    <option value="">All</option>
                                                    <option value="Sales" {% if request.GET.status == 'Sales' %}selected{% endif %}>Sales</option>
                                                    <option value="Return Inwards" {% if request.GET.status == 'Return Inwards' %}selected{% endif %}>Return Inwards</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <!-- Submit button -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>&nbsp;</label>
                                                <button type="submit" class="btn btn-primary btn-block">Filter</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                                <!-- Table for displaying orders -->
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered zero-configuration">
                                        <thead>
                                            <tr>
                                                <th>Order Date</th>
                                                <th>Invoice Id</th>
                                                <th>Total</th>
                                                <th>Payment</th>
                                                <th>Balance</th>
                                                <th>Due Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for order in invoices %}
                                            <tr>
                                                <td><i class="la la-calendar-check-o"></i>{{ order.created }}</td>
                                                <td><a href="{% url 'bakery:view_invoice_detail' order.id %}">{{ order.invoice_id }}</a></td>
                                                <td>{{ order.get_grand_total|floatformat:0 }}</td>
                                                <td>{{ order.total_amount_paid|floatformat:0 }}</td>
                                                <td>{{ order.balance_due|floatformat:0 }}</td>
                                                <td>{{ order.due_date }}</td>
                                                <td>{{ order.status }}</td>
                                                <td>
                                                <a href="{% url 'bakery:view_invoice_detail' order.id %}"><i class="ft-eye text-success"></i></a>
                                                <a href="{% url 'bakery:edit_invoice' order.id %}"><i class="ft-edit text-success"></i></a>
                                                <a href=""><i class="ft-trash-2 ml-1 text-danger"></i></a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th>Order Date</th>
                                                <th>Invoice Id</th>
                                                <th>Total</th>
                                                <th>Payment</th>
                                                <th>Balance</th>
                                                <th>Due Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Zero configuration table -->
        <section id="configuration">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Bakery Payments</h4>
                            <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                    <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                    <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                    <li><a data-action="close"><i class="ft-x"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-content collapse show">
                            <div class="card-body card-dashboard">
                                <p class="card-text">
                                    <!-- Display total return amount -->
                                    <strong>Total Payments Amount: {{ total_payments|floatformat:0 }} cfa </strong>
                                </p>
                             <!-- Form for filtering orders -->
                             <form method="GET" action="">
                                <div class="row">
                                    <!-- Start Date Filter -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="start_date">Start Date</label>
                                            <input type="date" class="form-control" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
                                        </div>
                                    </div>
                                    
                                    <!-- End Date Filter -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="end_date">End Date</label>
                                            <input type="date" class="form-control" id="end_date" name="end_date" value="{{ request.GET.end_date }}">
                                        </div>
                                    </div>
                                    
                                    <!-- Invoice Number Filter -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="invoice_number">Invoice Number</label>
                                            <input type="text" class="form-control" id="invoice_number" name="invoice_number" placeholder="Invoice #" value="{{ request.GET.invoice_number }}">
                                        </div>
                                    </div>
                                    
                                    <!-- Submit button -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>&nbsp;</label>
                                            <button type="submit" class="btn btn-primary btn-block">Filter</button>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Button to add payment -->
                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <a href="{% url 'bakery:add-payment' %}" class="btn btn-success btn-block">Add Payment</a>
                                </div>
                            </div>

                                <p class="card-text"></p>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered zero-configuration">
                                        <thead>
                                            <tr>
                                                <th>Payment Date</th>
                                                <th>Invoice Id</th>
                                                <th>Payment Id</th>
                                                <th>Employee</th>
                                                <th>Installment</th>
                                                <th>Inv Total</th>
                                                <th>Total Paid</th>
                                                <th>Amount</th>
                                                <th>Balance</th>
                                                
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                          {% for invoice_payment in payments %}

                                          <tr>
                                            <!--  <td>
                                                  <div class="custom-control custom-checkbox">
                                                      <input type="checkbox" class="custom-control-input" id="checkboxsmall1">
                                                      <label class="custom-control-label" for="checkboxsmall1"></label>
                                                  </div>
                                              </td> -->
                                              <td>
                                                      <div class="media-body media-middle">
                                                          <a class="media-heading name">{{invoice_payment.date}}</a>
                                                      </div>
                                              </td>
                                              
                                              <td>
                                                      <div class="media-body media-middle">
                                                          
                                                          <a href="{% url 'bakery:payment-details' invoice_payment.id %}" class="media-heading name">{{invoice_payment.invoice.invoice_id}}</a>
                                                      </div>
                                              </td>
                                              <td>
                                                      <div class="media-body media-middle">
                                                          <a href="" class="media-heading name">{{invoice_payment.payment_id}}</a>
                                                      </div>
                                              </td>
                                              <td>
                                                      <div class="media-body media-middle">
                                                          <span class="media-heading name">{{invoice_payment.employee}}</span>
                                                      </div>
                                              </td>

                                              <td>
                                                      <div class="media-body media-middle">
                                                          <span class="media-heading name">{{invoice_payment.payment_installment}}</span>
                                                      </div>
                                              </td>
                                              <td>
                                                <div class="media-body media-middle">
                                                    <span class="media-heading name">{{ invoice_payment.invoice.get_grand_total|floatformat:0 }}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="media-body media-middle">
                                                    <span class="media-heading name">{{invoice_payment.invoice.total_amount_paid|floatformat:0}}</span>
                                                </div>
                                             </td>
                                             <td>
                                                <div class="media-body media-middle">
                                                    <span class="media-heading name">{{ invoice_payment.amount_paid }}</span>
                                                </div>
                                            </td>
                                              <td>
                                                      <div class="media-body media-middle">
                                                          <a href="" class="media-heading name">{{invoice_payment.invoice.balance_due|floatformat:0}}</a>
                                                      </div>
                                              </td>

                                              
                                              <!-- <td>
                                                      <div class="media-body media-middle">
                                                          <span class="media-heading name">{{invoice_payment.payment_id}}</span>
                                                      </div>
                                              </td> -->

                                              <td>
                                                <a href="{% url 'bakery:payment-details' invoice_payment.id %}" data-toggle="" data-target="" class="primary edit mr-1"><i class="ft-eye text-success"></i></a>
                                                  <a href="{% url 'bakery:edit-payment' invoice_payment.id %}" data-toggle="" data-target="" class="primary edit mr-1"><i class="la la-pencil"></i></a>
                                                  <a class="danger delete mr-1"><i class="la la-trash-o"></i></a>
                                              </td>
                                          </tr>

                                          {% endfor %}


                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th>Payment Date</th>
                                                <th>Invoice Id</th>
                                                <th>Payment Id</th>
                                                <th>Employee</th>
                                                <th>Installment</th>
                                                <th>Inv Total</th>
                                                <th>Total Paid</th>
                                                <th>Amount</th>
                                                <th>Balance</th>
                                                
                                                <th>Actions</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--/ Zero configuration table -->


<!-- Zero configuration table -->
<section id="configuration">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Returns</h4>
                    <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3"></i></a>
                    <div class="heading-elements">
                        <ul class="list-inline mb-0">
                            <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                            <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                            <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                            <li><a data-action="close"><i class="ft-x"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-content collapse show">
                    <div class="card-body card-dashboard">
                        <p class="card-text">
                            <!-- Display total return amount -->
                            <strong>Total Returns Amount:{{total_returns|floatformat:0 }} cfa </strong>
                        </p>

                        <!-- Filter Form -->
                        <form method="GET" action="">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="start_date">Start Date</label>
                                        <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}">
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="end_date">End Date</label>
                                        <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}">
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                        <button type="submit" class="btn btn-primary btn-block">Filter</button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>Order Date</th>
                                        <th>Invoice Id</th>
                                        <th>Customer Name</th>
                                        <th>Total</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in returns %}
                                    <tr>
                                        <td><i class="la la-calendar-check-o"></i>{{ order.created }}</td>
                                        <td><a href="{% url 'bakery:view_invoice_detail' order.id %}">{{ order.invoice_id }}</a></td>
                                        <td>{{ order.customer }}</td>
                                        <td>{{ order.total_amount|floatformat:0 }} cfa</td>
                                        <td>{{ order.due_date }}</td>
                                        <td>{{ order.status }}</td>
                                        <td>
                                            <a href="{% url 'bakery:view_invoice_detail' order.id %}"><i class="ft-eye text-success"></i></a>
                                            <a href="{% url 'bakery:edit_invoice' order.id %}"><i class="ft-edit text-success"></i></a>
                                            <a href="#"><i class="ft-trash-2 ml-1 text-danger"></i></a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="7" class="text-center">No return items found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>Order Date</th>
                                        <th>Invoice Id</th>
                                        <th>Customer Name</th>
                                        <th>Total</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!--/ Zero configuration table -->





    </div>
</div>
</div>

{% endblock content %}
{% extends "base2.html" %}
{% block content %}{% load static %}
<!-- BEGIN: Content-->

<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="content-wrapper">
        <div class="content-header row">
            <div class="content-header-left col-md-6 col-12 mb-2">
                <h3 class="content-header-title">Purchase Receipt</h3>
                <div class="row breadcrumbs-top">
                    <div class="breadcrumb-wrapper col-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'bar:bar' %}">Home</a>
                            </li>
                            <li class="breadcrumb-item"><a href="{% url 'bar:purchases' %}">Purchase</a>
                            </li>
                            <li class="breadcrumb-item active">Purchase Receipt</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-body">
            <section class="card">
                <div id="invoice-template" class="card-body p-4">
                    <!-- Purchase Company Details -->
                    <div id="invoice-company-details" class="row">
                        <div class="col-sm-6 col-12 text-center text-sm-left">
                            <div class="media row">
                                <div class="col-12 col-sm-3 col-xl-2">
                                    <img src="{% static 'app-assets/images/logo/logo-80x80.png' %}" alt="company logo" class="mb-1 mb-sm-0" />
                                </div>
                                <div class="col-12 col-sm-9 col-xl-10">
                                    <div class="media-body">
                                        <ul class="ml-2 px-0 list-unstyled font-weight-bold">
                                            <li class="text-bold-800">Vendor Name: BJ Complex Ltd</li>
                                            <li>Address: Opposite ENEO office</li>
                                            <li>Sales Rep / Acc Manager: {{ purchase.employee }} / Akem</li>
                                            <li>Contact: +237 675 275 201 / 671 898 732</li>
                                            <li>Email: bjcomplex100@gmail.com</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12 text-center text-sm-right">
                            <h2>PURCHASE</h2>
                            <p class="pb-sm-3">#{{ purchase.purchase_id }}</p>
                            <ul class="px-0 list-unstyled">
                                <li>Balance Due</li>
                                <li class="lead text-bold-800 font-weight-bolder">{{ purchase.purchase_total|floatformat:0 }} cfa</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Purchase Company Details -->

                    <!-- Purchase Customer Details -->
                    <div id="invoice-customer-details" class="row pt-2">
                        <div class="col-12 text-center text-sm-left">
                            <p class="text-muted">Bill To</p>
                        </div>
                        <div class="col-sm-6 col-12 text-center text-sm-left">
                            <ul class="px-0 list-unstyled">
                                <li>Supplier Name: <b>{{ purchase.supplier_name }} </b> </li>
                                <li>Supplier Type: <b>{{ purchase.supplier_name.supplier_type }} </b> </li>
                                <li>Tel: <b>{{ purchase.supplier_name.phone1 }} </b> </li>
                                <li>Employee: <b>{{ purchase.employee }} </b> </li>
                            </ul>
                        </div>
                        <div class="col-sm-6 col-12 text-center text-sm-right">
                            <p><span class="text-muted">Purchase Date :</span> <b> {{ purchase.created }}</b> </p>
                            <p><span class="text-muted">Department :</span> <b> Boulangerie</b> </p>
                            <p><span class="text-muted">Due Date :</span> <b> {{ purchase.due_date }}</b> </p>
                        </div>
                    </div>
                    <!-- Purchase Customer Details -->

                    <!-- Purchase Items Details -->
                    <div id="invoice-items-details" class="pt-2">
                        <div class="row">
                            <div class="table-responsive col-12">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Status</th>
                                            <th>Item Name</th>
                                            <th class="text-right">Qty</th>
                                            <th class="text-right">Price</th>
                                            <!-- <th class="text-right">Amount</th> -->
                                            <th class="text-right">Discount</th>
                                            <th class="text-right">Discount Value</th>
                                            <th class="text-right">Net Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                      {% for item in purchases_detail %}
                                      
                                  
                                        <tr>
                                            <td>{{ purchase.status }}</td>
                                            <td>{{ item.product.product_name }}</td>
                                            <td class="text-right">{{ item.quantity|floatformat:0 }}</td>
                                            <td class="text-right">{{ item.price|floatformat:0 }} cfa</td>
                                            <!-- <td class="text-right">{{ total }} cfa</td> -->
                                            <td class="text-right">{{ item.discount_amount|floatformat:0 }} <b>({{ item.discount_value|floatformat:2 }})</b></td>
                                            <td class="text-right">{{ item.discount_value|floatformat:0 }} cfa</td>
                                            <td class="text-right">{{ item.total|floatformat:0 }} cfa</td>
                                        </tr>
                                      {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Returns Details -->
                        {% if purchase.return_items.exists %}
                        <div class="row">
                            <div class="col-sm-7 col-12 text-center text-sm-left">
                                <p class="lead">Returns:</p>
                                <div class="row">
                                    <div class="col-sm-8">
                                        <div class="table-responsive">
                                            <table class="table table-borderless table-sm">
                                              <thead>
                                                  <tr>
                                                      <th>Product</th>
                                                      <th>Qty</th>
                                                      <th>Price</th>
                                                      <th>Value</th>
                                                  </tr>
                                              </thead>
                                              <tbody>

                                                {% for ret in purchase.return_items.all %}
                                                  <tr>
                                                      <th scope="row">{{ ret.product }}</th>
                                                      <td>{{ ret.quantity }}</td>
                                                      <td>{{ ret.price }}</td>
                                                      <td class="text-right">{{ ret.total|floatformat:0 }} cfa</td>
                                                  </tr>
                                                {% endfor %}

                                              </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-sm-5 col-12">
                                <p class="lead">Total Due</p>
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td class="font-weight-bold primary">Grand Total</td>
                                                <td class="text-right font-weight-bold primary">{{ purchase.purchase_total|floatformat:0 }} cfa</td>
                                            </tr>
                                            <!-- <tr>
                                                <td class="font-weight-bold">VAT (19.25%)</td>
                                                <td class="text-right font-weight-bold">{{ purchase.vat_amount|floatformat:0 }} cfa</td>
                                            </tr> -->
                                            <!-- <tr>
                                                <td class="font-weight-bold">Discount( {{ purchase.get_discount_percentage|floatformat:2 }}%)</td>
                                                <td class="text-right font-weight-bold">{{ purchase.get_discount_total|floatformat:0 }} cfa</td>
                                            </tr> -->
                                            <!-- <tr>
                                                <td class="font-weight-bold">Returns</td>
                                                <td class="text-right font-weight-bold">({{ purchase.get_net_amount|floatformat:0 }}) cfa</td>
                                            </tr> -->
                                            <!-- <tr>
                                                <td class="text-bold-800 font-weight-bold">Amount to be Paid</td>
                                                <td class="text-bold-800 text-right font-weight-bold">{{ purchase.get_grand_total|floatformat:0 }} cfa</td>
                                            </tr> -->
                                            <!-- <tr>
                                                <td class="text-bold-800 font-weight-bold primary">Payments Installments ({{ payment_installment_count }})</td>
                                                <td class="text-bold-800 text-right font-weight-bold primary">{{ total_payments|floatformat:0 }} cfa</td>
                                            </tr> -->
                                            <!-- <tr>
                                                <td class="text-bold-800 font-weight-bold danger">Balance Due</td>
                                                <td class="text-bold-800 text-right font-weight-bold danger">{{ balance_due|floatformat:0 }} cfa</td>
                                            </tr> -->
                                        </tbody>
                                    </table>
                                </div>
                                
                            </div>
                        </div>
                        <div class="text-right">
                                    <p class="mb-0 mt-1">Authorized person</p>
                                    <img src="{% static '' %}app-assets/images/pages/signature-scan.png" alt="signature" class="height-100" />
                                    <h6>Amanda Orton</h6>
                                    <p class="text-muted">Managing Director</p>
                                </div>
                    </div>
                    <!--/ Purchase Footer -->
                    <!-- Purchase Footer -->
                    <div id="invoice-footer">
                        <div class="row">
                            <div class="col-sm-7 col-12 text-center text-sm-left">
                                <h6>Terms & Condition</h6>
                                <p>For any inquiry contact the Sales Rep and the Account Manager.</p>
                            </div>
                            <div class="col-sm-5 col-12 text-center">
                                <button type="button" class="btn btn-info btn-print btn-lg my-1" id="printInvoice"><i class="la la-paper-plane-o mr-50"></i>
                                    Print
                                    Purchase</button>
                                    <button type="button" class="btn btn-info btn-print btn-lg my-1" id="downloadInvoice"><i class="la la-paper-plane-o mr-50"></i>
                                        Download
                                        Purchase</button>
                            </div>
                            
                        </div>
                    </div>
                    <!-- Purchase Footer -->

                </div>
            </section>
        </div>
    </div>
</div>

{% endblock %}


{% block custom_js %}
{% load static %}
<script src="{% static 'app-assets/js/html2pdf.bundle.min.js' %}"></script></script>
{% load static %}
<link rel="stylesheet" href="{% static '' %}app-assets/custom/selectize.bootstrap3.css">
<script src="{% static '' %}app-assets/custom/jquery-3.6.0.min.js"></script>
<script src="{% static 'app-assets/custom/jquery.validate.min.js' %}"></script>
<script src="{% static 'app-assets/custom/selectize.min.js' %}"></script>
<script>
    document.getElementById("downloadInvoice").addEventListener("click", function () {
        var element = document.getElementById('invoice-template');
        var opt = {
            margin:       0,
            filename:     '{{ purchase.purchase_id }}.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'Legal', orientation: 'portrait' }
        };
        html2pdf().from(element).set(opt).save();
    });
    </script>
    
{% load static %}
<link rel="stylesheet" href="{% static '' %}app-assets/custom/selectize.bootstrap3.css">
<script src="{% static '' %}app-assets/custom/jquery-3.6.0.min.js"></script>
<script src="{% static 'app-assets/custom/jquery.validate.min.js' %}"></script>
<script src="{% static 'app-assets/custom/selectize.min.js' %}"></script>
<script>
    document.getElementById("printInvoice").addEventListener("click", function () {
        var printContents = document.getElementById('invoice-template').innerHTML;
        var originalContents = document.body.innerHTML;
    
        document.body.innerHTML = printContents;
    
        window.print();
    
        document.body.innerHTML = originalContents;
        location.reload();  // Refresh the page to restore original state
    });
    </script>
    
    {% endblock %}